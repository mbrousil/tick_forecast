read_rds("data/high_temporal_res/blan_small_mammal.rds") %>%
select(siteID, plotID, trapCoordinate, plotType,
nlcdClass, trapStatus, collectDate,
lifeStage, taxonID, scientificName,
taxonRank, contains("ticks")) %>%
pull(trapStatus) %>%
unique()
small_mammal
small_mammal %>%
count(siteID, plotID, trapCoordinate, collectDate) %>%
count()
small_mammal %>%
count(siteID, plotID, trapCoordinate, collectDate)
small_mammal %>%
count(siteID, plotID, trapCoordinate, collectDate) %>%
filter(n > 1)
small_mammal %>%
filter(plotID == "BLAN_001",
collectDate %in% c("2021-04-14", "2015-05-21", "2021-07-09"),
trapCoordinate %in% c("A2", "H10", "XX"))
small_mammal %>%
filter(plotID == "BLAN_001",
collectDate %in% ymd(c("2021-04-14", "2015-05-21", "2021-07-09")),
trapCoordinate %in% c("A2", "H10", "XX"))
small_mammal %>%
filter(plotID == "BLAN_001",
collectDate %in% ymd(c("2021-04-14", "2015-05-21", "2021-07-09")),
trapCoordinate %in% c("A2", "H10", "XX")) %>%
arrange(trapStatus)
small_mammal
mammal_success <- small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"))
mammal_success
janitor::get_dupes(mammal_success)
janitor::get_dupes(read_rds(file = "data/high_temporal_res/blan_small_mammal.rds"))
read_rds(file = "data/high_temporal_res/blan_small_mammal.rds") %>%
filter(trapCoordinate == "XX")
read_rds(file = "data/high_temporal_res/blan_small_mammal.rds") %>%
filter(trapCoordinate == "XX", collectDate == "2021-07-09")
read_rds(file = "data/high_temporal_res/blan_small_mammal_meta.rds.rds") %>%
filter(trapCoordinate == "XX", collectDate == "2021-07-09")
read_rds(file = "data/high_temporal_res/blan_small_mammal_meta.rds.rds")
neon_read(table = "mam_perplotnight", site = "BLAN")
neon_read(table = "mam_perplotnight", site = "BLAN") %>%
View()
neon_read(table = "mam_perplotnight", site = "BLAN") %>%
filter(trapCoordinate == "XX", collectDate == "2021-07-09")
neon_read(table = "mam_perplotnight", site = "BLAN") %>%
filter(collectDate == "2021-07-09")
neon_read(table = "mam_perplotnight", site = "BLAN") %>%
filter(collectDate == "2021-07-09")
read_rds(file = "data/high_temporal_res/blan_small_mammal_meta.rds.rds") %>%
filter(trapCoordinate == "XX", collectDate == "2021-07-09")
janitor::get_dupes(read_rds(file = "data/high_temporal_res/blan_small_mammal.rds"))
read_rds(file = "data/high_temporal_res/blan_small_mammal.rds") %>%
filter(trapCoordinate == "XX", collectDate == "2021-07-09")
read_rds(file = "data/high_temporal_res/blan_small_mammal.rds") %>%
filter(trapCoordinate == "XX", collectDate == "2021-07-09") %>%
View()
small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"),
if_any(.cols = matches("Ticks"),
.fns = .x == "U"))
small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"),
if_any(.cols = matches("Ticks"),
.fns = ~.x != "U"))
small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"),
if_any(.cols = matches("Ticks"))
)
small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"))
small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"))
# Compile all mammal datasets into one data frame
mammal_compiled <- map_df(.x = list.files(path = "data/high_temporal_res/",
pattern = "small_mammal.rds",
full.names = TRUE),
.f = ~ {
# Keep the site ID for later use
site_id <- gsub(pattern = "data/high_temporal_res/|_small_mammal.rds",
replacement = "",
x = .x)
# Read in data and select the most helpful cols
small_mammal <- read_rds(.x) %>%
select(siteID, plotID, trapCoordinate, plotType,
nlcdClass, trapStatus, collectDate,
lifeStage, taxonID, scientificName,
taxonRank, contains("ticks"))
mammal_success <- small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"))
# Return to the outer function
return(mammal_success)
})
mammal_compiled
# Compile all mammal datasets into one data frame
mammal_daily_compiled <- map_df(.x = list.files(path = "data/high_temporal_res/",
pattern = "small_mammal.rds",
full.names = TRUE),
.f = ~ {
# Keep the site ID for later use
site_id <- gsub(pattern = "data/high_temporal_res/|_small_mammal.rds",
replacement = "",
x = .x)
# Read in data and select the most helpful cols
small_mammal <- read_rds(.x) %>%
select(siteID, plotID, trapCoordinate, plotType,
nlcdClass, trapStatus, collectDate,
lifeStage, taxonID, scientificName,
taxonRank, contains("ticks"))
mammal_success <- small_mammal %>%
# Something captured
filter(trapStatus %in% c("4 - more than 1 capture in one trap",
"5 - capture"))
# Return to the outer function
return(mammal_success)
})
# Export the final temp dataset
write_csv(x = mammal_daily_compiled,
file = "data/neon_mammals_daily_compiled.csv")
View(mammal_daily_compiled)
mammal_daily_compiled %>%
group_by(mmwr_week = epiweek(collectDate), siteID, lifestage, scientificName) %>%
summarize(sp_count = n(),
larval_tick_days = n(larvalTicksAttached))
mammal_daily_compiled %>%
group_by(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName) %>%
summarize(sp_count = n(),
larval_tick_days = n(larvalTicksAttached))
mammal_daily_compiled %>%
group_by(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName) %>%
summarize(sp_count = n())
mammal_daily_compiled %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
larvalTicksAttached)
mammal_daily_compiled %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
larvalTicksAttached)
mammal_daily_compiled %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks") %>%
group_by(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName) %>%
summarize(sp_count = n())
mammal_daily_compiled %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks")
mammal_daily_compiled %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks")
mammal_daily_compiled %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks") %>%
group_by(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName) %>%
summarize(sp_count = n())
mammal_daily_compiled %>%
group_by(mmwr_week = epiweek(collectDate), siteID, lifeStage, scientificName) %>%
summarize(sp_count = n())
mammal_daily_compiled %>%
group_by(year = year(collectDate), mmwr_week = epiweek(collectDate),
siteID, lifeStage, scientificName) %>%
summarize(sp_count = n())
mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks")
mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks") %>%
select(siteID, lifeStage, scientificName)
mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks")
mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks") %>%
select(year, mmwr_week, siteID, lifeStage, scientificName, contains("ind_w"))
mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks")
mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
filter(larvalTicksAttached == "Y") %>%
select(year, mmwr_week, siteID, lifeStage, scientificName, contains("ind_w"))
mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
filter(larvalTicksAttached == "Y") %>%
select(year, mmwr_week, siteID, lifeStage, scientificName, ind_w_larval_ticks) %>%
distinct()
mammal_larval_ticks <- mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
larvalTicksAttached, name = "ind_w_larval_ticks") %>%
filter(larvalTicksAttached == "Y") %>%
select(year, mmwr_week, siteID, lifeStage, scientificName, ind_w_larval_ticks) %>%
distinct()
mammal_nymphal_ticks <- mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
filter(nymphalTicksAttached == "Y") %>%
select(year, mmwr_week, siteID, lifeStage, scientificName, nymphalTicksAttached) %>%
distinct()
mammal_nymphal_ticks
mammal_nymphal_ticks <- mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
nymphalTicksAttached, name = "ind_w_nymphal_ticks") %>%
filter(nymphalTicksAttached == "Y") %>%
select(year, mmwr_week, siteID, lifeStage, scientificName, ind_w_nymphal_ticks) %>%
distinct()
mammal_nymphal_ticks
mammal_adult_ticks <- mammal_daily_compiled %>%
add_count(year = year(collectDate), mmwr_week = epiweek(collectDate), siteID,
lifeStage, scientificName,
adultTicksAttached, name = "ind_w_adult_ticks") %>%
filter(adultTicksAttached == "Y") %>%
select(year, mmwr_week, siteID, lifeStage, scientificName, ind_w_adult_ticks) %>%
distinct()
mammal_adult_ticks
reduce(.x = list(mammal_larval_ticks, mammal_nymphal_ticks, mammal_adult_ticks),
.f = full_join,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName"))
reduce(.x = list(mammal_larval_ticks, mammal_nymphal_ticks, mammal_adult_ticks),
.f = full_join,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName")) %>%
mutate(across(.cols = matches("ind_w_"),
.fns = ~replace_na(replace = 0)))
reduce(.x = list(mammal_larval_ticks, mammal_nymphal_ticks, mammal_adult_ticks),
.f = full_join,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName")) %>%
mutate(across(.cols = matches("ind_w_"),
.fns = ~replace_na(data = ., replace = 0)))
mammal_ticks <- reduce(.x = list(mammal_larval_ticks, mammal_nymphal_ticks, mammal_adult_ticks),
.f = full_join,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName")) %>%
mutate(across(.cols = matches("ind_w_"),
.fns = ~replace_na(data = ., replace = 0)))
mammal_daily_compiled %>%
group_by(year = year(collectDate), mmwr_week = epiweek(collectDate),
siteID, lifeStage, scientificName) %>%
summarize(sp_count = n())
mammal_daily_compiled %>%
count(year = year(collectDate), mmwr_week = epiweek(collectDate),
siteID, lifeStage, scientificName)
full_join(x = mammal_counts,
y = mammal_ticks,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName"))
mammal_counts <- mammal_daily_compiled %>%
count(year = year(collectDate), mmwr_week = epiweek(collectDate),
siteID, lifeStage, scientificName)
full_join(x = mammal_counts,
y = mammal_ticks,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName"))
mammal_ticks <- reduce(.x = list(mammal_larval_ticks, mammal_nymphal_ticks, mammal_adult_ticks),
.f = full_join,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName"))
mammal_counts <- mammal_daily_compiled %>%
count(year = year(collectDate), mmwr_week = epiweek(collectDate),
siteID, lifeStage, scientificName)
full_join(x = mammal_counts,
y = mammal_ticks,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName")) %>%
mutate(across(.cols = c(n, ind_w_larval_ticks, ind_w_nymphal_ticks, ind_w_adult_ticks),
.fns = ~replace_na(data = ., replace = 0)))
mammals_weekly <- full_join(x = mammal_counts,
y = mammal_ticks,
by = c("year", "mmwr_week", "siteID", "lifeStage", "scientificName")) %>%
mutate(across(.cols = c(n, ind_w_larval_ticks, ind_w_nymphal_ticks, ind_w_adult_ticks),
.fns = ~replace_na(data = ., replace = 0)))
# Export the final temp dataset
write_csv(x = mammals_weekly,
file = "data/neon_mammals_weekly_compiled.csv")
# Our sites:
neon_sites <- read_csv(file = "data/Ticks_NEON_Field_Site_Metadata_20210928.csv") %>%
select(field_domain_id, field_site_id, field_site_name, field_site_state,
field_latitude, field_longitude)
# MHK near KONZ
konz_additional <- riem_measures(station = "MHK",
date_start = "2014-09-01",
date_end = "2020-09-20")
konz_additional
?riem_measures
?riem_measures
konz_additional
# MHK near KONZ
konz_prop_na_precip <- konz_additional %>%
add_count(year = year(valid), day = yday(valid)) %>%
group_by(year, day) %>%
summarize(total_n = unique(n),
non_na_count = sum(!is.na(p01i)),
prop_na = round(((total_n - non_na_count) / total_n),
digits = 2)) %>%
select(year, day, total_n, prop_na)
konz_prop_na_precip
konz_prop_na_precip %>%
filter(is.na(prop_na))
konz_additional %>%
group_by(year = year(valid), day = yday(valid)) %>%
summarize(sum_precip = sum(p01i, na.rm = TRUE))
?conv_unit_options
# Aggregate data to day level
konz_agg_precip <- konz_additional %>%
group_by(year = year(valid), day = yday(valid)) %>%
summarize(sum_precip_in = sum(p01i, na.rm = TRUE)) %>%
transmute(year,
day,
sum_precip_mm = sum_precip_in * 25.4) %>%
ungroup()
konz_agg_precip
left_join(
x = konz_agg_precip,
y = konz_prop_na_precip,
by = c("year", "day"))
left_join(
x = konz_agg_precip,
y = konz_prop_na_precip,
by = c("year", "day")) %>%
mutate(
# Tag with site ID
site_id = "konz",
date = (ymd(paste0(year, "-01-01")) + day) - 1)
left_join(
x = konz_agg_precip,
y = konz_prop_na_precip,
by = c("year", "day")) %>%
mutate(
# Tag with site ID
site_id = "konz",
date = (ymd(paste0(year, "-01-01")) + day) - 1) %>%
# Rearrange for easier reading
select(site_id, year, day, date, total_n, prop_na, everything()) %>%
arrange(date)
# Join aggregated data with NA proportions
konz_precip_output <- left_join(
x = konz_agg_precip,
y = konz_prop_na_precip,
by = c("year", "day")) %>%
mutate(
# Tag with site ID
site_id = "konz",
date = (ymd(paste0(year, "-01-01")) + day) - 1) %>%
# Rearrange for easier reading
select(site_id, year, day, date, total_n, prop_na, everything()) %>%
arrange(date)
precip_compiled <- read_csv(file = "data/neon_temp_compiled.csv")
precip_compiled
precip_compiled <- read_csv(file = "data/neon_precip_compiled.csv")
precip_compiled
inner_join(x = precip_compiled,
y = konz_precip_output,
by = c("site" = "site_id", "date", "year", "day"),
suffix = c("_full", "_konz")) %>%
ggplot() +
geom_point(
aes(x = mean_temp_c_full, y = mean_temp_c_konz, fill = as.factor(year)),
color = "black", shape = 21) +
xlab("NEON temp, C") +
ylab("ASOS temp, C") +
facet_wrap(vars(year)) +
scale_fill_viridis_d("Year") +
theme_bw() +
ggtitle("Site: KONZ")
inner_join(x = precip_compiled,
y = konz_precip_output,
by = c("site" = "site_id", "date", "year", "day"),
suffix = c("_full", "_konz")) %>%
ggplot() +
geom_point(
aes(x = mean_temp_c_full, y = sum_precip_mm, fill = as.factor(year)),
color = "black", shape = 21) +
xlab("NEON precip, mm") +
ylab("ASOS precip, mm") +
facet_wrap(vars(year)) +
scale_fill_viridis_d("Year") +
theme_bw() +
ggtitle("Site: KONZ")
inner_join(x = precip_compiled,
y = konz_precip_output,
by = c("site" = "site_id", "date", "year", "day"),
suffix = c("_full", "_konz"))
inner_join(x = precip_compiled,
y = konz_precip_output,
by = c("site" = "site_id", "date", "year", "day"),
suffix = c("_full", "_konz")) %>%
ggplot() +
geom_point(
aes(x = sum_precip_mm_full , y = sum_precip_mm_konz, fill = as.factor(year)),
color = "black", shape = 21) +
xlab("NEON precip, mm") +
ylab("ASOS precip, mm") +
facet_wrap(vars(year)) +
scale_fill_viridis_d("Year") +
theme_bw() +
ggtitle("Site: KONZ")
inner_join(x = precip_compiled,
y = konz_precip_output,
by = c("site" = "site_id", "date", "year", "day"),
suffix = c("_full", "_konz")) %>%
ggplot() +
geom_point(
aes(x = sum_precip_mm_full , y = sum_precip_mm_konz, fill = as.factor(year)),
color = "black", shape = 21) +
xlab("NEON precip, mm") +
ylab("ASOS precip, mm") +
xlim(c(0, 1000)) +
ylim(c(0, 1000)) +
facet_wrap(vars(year)) +
scale_fill_viridis_d("Year") +
theme_bw() +
ggtitle("Site: KONZ")
inner_join(x = precip_compiled,
y = konz_precip_output,
by = c("site" = "site_id", "date", "year", "day"),
suffix = c("_full", "_konz")) %>%
ggplot() +
geom_point(
aes(x = sum_precip_mm_full , y = sum_precip_mm_konz, fill = as.factor(year)),
color = "black", shape = 21) +
xlab("NEON precip, mm") +
ylab("ASOS precip, mm") +
xlim(c(0, 1200)) +
ylim(c(0, 1200)) +
facet_wrap(vars(year)) +
scale_fill_viridis_d("Year") +
theme_bw() +
ggtitle("Site: KONZ")
inner_join(x = precip_compiled,
y = konz_precip_output,
by = c("site" = "site_id", "date", "year", "day"),
suffix = c("_full", "_konz")) %>%
ggplot() +
geom_point(
aes(x = sum_precip_mm_full , y = sum_precip_mm_konz, fill = as.factor(year)),
color = "black", shape = 21) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed") +
xlab("NEON precip, mm") +
ylab("ASOS precip, mm") +
xlim(c(0, 1200)) +
ylim(c(0, 1200)) +
facet_wrap(vars(year)) +
scale_fill_viridis_d("Year") +
theme_bw() +
ggtitle("Site: KONZ")
